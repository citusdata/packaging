#!/usr/bin/make -f

HANAME := $(lastword $(shell grep "Package: citus-ha" debian/control))

include /usr/share/postgresql-common/pgxs_debian_control.mk
clean: debian/control

.PHONY: debian/control

override_dh_auto_build:
	+make -C $(shell pwd)/src/bin/citusha
	+pg_buildext build $(shell pwd)/src/monitor build-%v

override_dh_auto_clean:
	+make -C $(shell pwd)/src/bin/citusha clean
	+pg_buildext clean $(shell pwd)/src/monitor build-%v

override_dh_auto_test:
	# nothing to do here, see debian/tests/* instead

override_dh_auto_install:
	+make -C $(shell pwd)/src/bin/citusha install \
		DESTDIR=$(CURDIR)/debian/${HANAME} \
		BINDIR=/usr/bin
	+pg_buildext install $(shell pwd)/src/monitor build-%v postgresql-%v-citus-ha

%:
	dh $@
